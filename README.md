## pekchat聊天室

pekchat聊天室是基于Linux C网络编程技术编写的多人即时聊天程序，使用C++语言编写。

### 安装部署

**将在下个版本发布完整部署流程**

* 前置准备
  * 安装MySQL
  * 安装MySQL C API（libmysqlclient）

- 克隆
``` shell?linenums
git clone git@github.com:Caesar41/linuxCpp_socket_pekchat.git
```
- 服务器端
``` shell?linenums
cd linuxCpp_socket_pekchat/server
make
```
 - 客户端

``` shell?linenums
cd linuxCpp_socket_pekchat/client
make
```
### 展示视频

视频暂无，将在alpha版本全部完成后更新。

[图片展示](doc/display.md)

### 项目概述

- 本项目是一个使用Linux C网络编程技术开发的命令行界面聊天室，基本功能有：用户注册登录，添加好友，私聊，聊天记录查看等。
- 项目还在进行，目前已完成基本功能（包括注册登录、消息收发）
### 项目设计

- 项目基于C/S模型设计，客户端直接连接到服务端，与服务端双向交换数据，服务端用于接收客户端发来的请求，并向目标用户转发必要的信息，所有数据的数据库存储操作均由服务端完成。

- 项目代码采用分层思想进行设计，客户端由UI层和功能层（function）构成，服务端由功能层（service）和数据层（database）构成。

- 服务端与客户端均采用双线程模式

  - 服务端：生产者-消费者模型

    - 主线程使用epoll模型处理并发请求，负责客户端的连接、断开与所有报文的处理。此线程作为生产者，会将收到的报文全部加入一个队列内
    - 业务线程作为消费者，会从队列中依次取出报文进行处理
    - 使用互斥锁与条件变量实现线程同步

  - 客户端：

    - 主线程与用户交互，提供UI界面与交互接口
    - 业务线程负责获取所有服务端发来的报文并进行处理

    - 当客户端需要等待服务端的回应时，同样使用互斥锁与条件变量实现线程同步，在满足条件后，业务线程会唤醒主线程

- 为了统一处理，服务端与客户端的所有通信均采用相同格式的报文（message），且本项目编写了解析与封装函数，以将报文在二进制流与对象之间相互转换。同时，考虑到可移植性，相关函数均考虑了字节序的问题。报文格式说明如下：

  - 报文总长为1024字节
  - 报文由10个整数，4个20字节长的字符串与一个长字符串构成
  - 每个部分均有固定含义，如前数个整数组成“首部”。读取与赋值均借助类方法与宏定义完成

- 数据库设计

  - 暂无

- 鲁棒性设计

  - 信号处理函数
  - 线程清理函数
  - 心跳报文

### 项目进度

* todo
  * 完成聊天记录功能
  * 鲁棒性（安全退出、析构、线程清理、数据库退出）
  * log完善